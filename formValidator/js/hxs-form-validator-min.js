/**
 * v1.0
 * form validator utils
 * @author liujie
 * @date 2019-03-25 14:45
 */
!function(e,t){var a=a||{};"function"==typeof a&&a.amd?a([],t):"object"==typeof exports&&"object"==typeof module?module.exports=t():"object"==typeof exports?exports.FormUtils=t():e.FormUtils=t()}(this,function(){function e(e){this.data={},this.result={},this.settings=$.extend({},this.defaults,e||{}),this.errorMessage=$.extend({},this.defaults.messages,this.settings.messages||{})}return e.prototype={defaults:{errorElement:"label",errorClass:"alert alert-danger",messages:{required:"请输入有效数据",remote:"请修正此字段",date:"请输入有效的日期",dateISO:"请输入有效的日期 (YYYY-MM-DD)",digits:"只能输入数字",creditcard:"请输入有效的信用卡号码",equalTo:"你的输入不相同",extension:"请输入有效的后缀",maxlength:"最多可以输入 {0} 个字符",minlength:"最少要输入 {0} 个字符",rangelength:"请输入长度在 {0} 到 {1} 之间的字符串",range:"请输入范围在 {0} 到 {1} 之间的数值",max:"请输入不大于 {0} 的数值",min:"请输入不小于 {0} 的数值",invalid:"无效的输入",checked:"请选择",empty:"请输入有效数据",url:"请输入有效的网址",number:"请输入有效的数字",email:"请输入有效的电子邮件地址",emailRepeat:"两次邮件地址输入不一致",passwordRepeat:"两次密码输入不一致",repeat:"两次输入不一致",complete:"输入不完整",select:"必选项",time:"请输入正确的时间",default:""},rules:{email:{filter:/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,illegalChars:/[\(\)\<\>\,\;\:\\\/\"\[\]]/},url:/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[\/?#]\S*)?$/,date:/Invalid|NaN/,dateISO:/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/,number:/^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/,digits:/^\d+$/,phone:/^\+?([0-9]|[-|' '])+$/i,time:/^([0-1][0-9]|2[0-3]):[0-5][0-9]$/}},methods:{url:function(e,t){return!!this.settings.rules.url.test(t.val)||this.errorMessage.url},email:function(e,t){return!(!this.settings.rules.email.filter.test(t.val)||t.val.match(this.settings.rules.email.illegalChars))||this.errorMessage.email},text:function(e,t){let a=t.val?t.val.length:0;if(0===a)return this.errorMessage.required;if(t.minlength&&a<t.minlength)return this.errorMessage.minlength.replace("{0}",t.minlength);if(t.maxlength&&a>t.maxlength)return this.errorMessage.maxlength.replace("{0}",t.maxlength);if(t.pattern){var r,s;switch(t.pattern){case"alphanumeric":r=this.settings.rules.alphanumeric;break;case"numeric":r=this.settings.rules.digits;break;case"phone":r=this.settings.rules.phone;break;default:r=t.pattern}try{if(s=new RegExp(r).test(t.val),t.val&&!s)return this.texts.invalid}catch(t){return console.warn(t,e,"regex is invalid"),this.texts.invalid}}return!0},number:function(e,t){var a=0|t.val;return isNaN(parseFloat(a))&&!isFinite(a)?this.errorMessage.number:this.settings.rules.number.test(t.val)?t.max&&a>t.max?this.errorMessage.max.replace("{0}",t.max):t.max&&a<t.max?this.errorMessage.min.replace("{0}",t.min):t.maxlength&&t.minlength&&(a.length>t.maxlength||a.length<t.minlength)?this.errorMessage.range.replace("{0}",t.minlength).replace("{1}",t.maxlength):t.maxlength&&a.length>t.maxlength?this.errorMessage.maxlength.replace("{0}",t.maxlength):!(t.minlength&&a.length<t.minlength)||this.errorMessage.minlength.replace("{0}",t.minlength):this.errorMessage.number},date:function(e,t){return!!this.settings.rules.date.test(new Date(t.val))||this.errorMessage.date},dateISO:function(e,t){return!!this.settings.rules.dateISO.test(new Date(t.val))||this.errorMessage.dateISO},time:function(e,t){return!!this.settings.rules.time.test(t.val)||this.errorMessage.time},select:function(e,t){return!!t.val||this.errorMessage.select},checkbox:function(e,t){return!!t.val||this.errorMessage.checked},equalTo:function(e,t,a){return e?t==e||(this.errorMessage[a+"Repeat"]||this.errorMessage.default):this.errorMessage.required},isNull:function(e){return!!e||this.errorMessage.empty}},check:function(e,t){var a=(t=$.extend({},t)).type;return"tel"==a&&(t.pattern=t.pattern||"phone"),a&&"password"!=a&&"tel"!=a&&"search"!=a&&"file"!=a||(a="text"),!this.methods[a]||this.methods[a].call(this,e,t)},showError:function(e,t){var a=$("#"+e.id+"-error");if(a.length>0)a.html(t||"");else{var r=$("<"+this.settings.errorElement+">").attr("id",e.id+"-error").attr("style","width:100%;padding:0;margin-bottom:0").addClass(this.settings.errorClass).html(t||"");$(e).after(r)}},destroy:function(e){var t=$("#"+e.id+"-error");t.length>0&&(t.removeClass(this.settings.errorClass),t.html(""))},prepareFieldData:function(e){let t=e.nodeName.toLowerCase();this.data.valid=!0,this.data.type=e.getAttribute("type"),this.data.val=e.value.replace(/^\s+|\s+$/g,""),this.data.pattern=e.getAttribute("pattern"),"select"===t?this.data.type="select":"textarea"===t&&(this.data.type="text"),this.data.max=e.getAttribute("max"),this.data.min=e.getAttribute("min"),this.data.maxlength=e.getAttribute("maxlength"),this.data.minlength=e.getAttribute("minlength"),this.data.validateRepeat=e.getAttribute("validate-repeat")},checkField:function(e){if("hidden"!=e.type&&$(e).is(":hidden"))return!0;if(!(e=this.filterFormElements([e])[0]))return!0;if(this.prepareFieldData(e),errorMessage=this.errorMessage[e.name]||this.errorMessage.invalid,this.result.valid=this.methods.isNull.call(this,this.data.val),$(e).hasClass("optional")&&!this.data.valid&&(this.result.valid=!0),this.data.valid&&(errorMessage=this.check.call(this,e,this.data),this.result.valid=!0===errorMessage),this.data.valid&&this.data.validateRepeat){var t=0==this.data.validateRepeat.indexOf("#")?$(this.data.validateRepeat):$(":input[name="+this.data.validateRepeat+"]");errorMessage=this.methods.equalTo.call(this,this.data.val,t.val(),this.data.type),this.result.valid=!0===errorMessage}return this[this.result.valid?"destroy":"showError"](e,errorMessage),{valid:this.result.valid,error:!0===this.result.valid?"":errorMessage}},filterFormElements:function(e){var t,a=[];for(t=e.length;t--;){var r=e[t].nodeName.match(/input|textarea|select/gi),s=e[t].hasAttribute("required"),i=e[t].hasAttribute("disabled"),n=-1!=e[t].className.indexOf("optional");r&&(s||n)&&!i&&a.push(e[t])}return a},bindEvent:function(e){var t=this,a=["blur","input","change"];function r(a){e.addEventListener(a,function(e){t.checkField(e.target)},!0)}e&&a&&(a instanceof Array?a.forEach(r):"string"==typeof a&&r(a))},validator:function(e){let t=$(e),a=this;if(this.bindEvent(t[0]),0==t.length)return console.warn("element not found"),!1;let r=!0;return this.filterFormElements(t[0]).forEach(function(e,t){let s=a.checkField(e);r*=s.valid}),!!r}},e});